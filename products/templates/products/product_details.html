{% extends "base.html" %}
{% load static %}

{% block page_header %}
<!-- This is needed to push the content down
    under the navigation bar  -->
<div class="container top-head-container">
    <div class="row">
        <div class="col"></div>
    </div>
</div>
{% endblock %}

{% block content %}
<!-- Product details container -->
<div class="container-fluid">
    <div class="row">
        <div class="col-12 col-md-6 col-lg-4 offset-lg-2">
            <!-- Image container left side -->
            <div class="image-con my-5">
                <!-- Django if statement to check if there is a product image url and if
                    true, insert image url into image source from the products db and if false 
                    then insert the no image url into the image source same as the all products page -->
                {% if product.product_image %}
                <a href="{{ product.product_image.url }}" target="_blank">
                    <img class="img-fluid" src="{{ product.product_image.url }}" alt="{{ product.product_name }}">
                </a>
                {% else %}
                <a href="{{ product.product_image.url }}">
                    <img class="img-fluid" src="/media/noimage_img.jpg" alt="{{ product.product_name }}">
                </a>
                {% endif %}
            </div>
        </div>

        <div class="col-12 col-md-6 col-lg-4">
            <!-- Product details container right side -->
            <div class="product-detail-con mb-5 mt-md-5">
                <!-- This Django if statement checks to see if there is a product rating and if true
                    the product rating will display as a single digit number, else if false no rating will be displayed. 
                    A write a review anchor link once clicked will take user to the write a review section at the bottom of the page
                    and a review count number will also be shown -->
                {% if product.product_rating %}
                <div class="mb-1">
                    <small class="text-muted"><i class="fas fa-star mr-1"></i>
                        {{ product.product_rating|floatformat:0 }} / 5 (0)
                        <a href="">Write a review</a></small>
                </div>
                {% else %}
                <small class="text-muted">No Rating</small>
                {% endif %}
                <!-- Product name -->
                <p class="mb-0">{{ product.product_name }}</p>
                <!-- Product description -->
                <p class="mt-3">{{ product.product_description }}</p>
                <!-- Product price -->
                <p class="lead mb-0 text-left font-weight-bold">Â£{{ product.product_price }}</p>

                <!-- Django if statement checking to see if the product has a category and then
                                    displaying under the product price  -->
                {% if product.category %}
                <p class="small my-1">
                    <a class="text-muted" href="{% url 'products' %}?category={{ product.category.category_name }}">
                        <i class="fas fa-layer-group me-1"></i>{{ product.category.category_friendly_name }}
                    </a>
                </p>
                {% endif %}
                <!-- Add to trolley form -->
                <form class="form" action="{% url 'add_to_trolley' product.id %}" method="POST">
                    <!-- Using Django's cross site request forgery token because Django will not
                    allow the form to be submitted -->
                    {% csrf_token %}
                    <div class="form-row">
                        <!-- Size selector dropdown using a django with statement so that the var sizes can
                        be used in another location -->
                        {% with product.product_sizes as sizes %}
                            {% if sizes %}
                                <!-- This column is for the product sizes dropdown -->
                                <div class="col-12">
                                    <p class="mt-3 fw-bold">Size:</p>
                                    <select class="form-control rounded-0 w-25" name="clothing_sizes" id='id_clothing_size'>
                                        <option value="xs">XS</option>
                                        <option value="s">S</option>
                                        <option value="m" selected>M</option>
                                        <option value="l">L</option>
                                        <option value="xl">XL</option>
                                        <option value="xxl">XXL</option>
                                        <option value="xxxl">XXXL</option>
                                    </select>
                                </div>
                            {% endif %}
                        <!-- This column is for the product quantity -->
                        <div class="col-12">
                            <p class="mt-3 fw-bold">Quantity:</p>
                            <div class="form-group w-25">
                                <div class="input-group">
                                    <input class="form-control rounded-0 quantity_input" type="number" name="product_quantity" value="1"
                                        min="1" max="99" data-item_id="{{ product.id }}" id="id_qty_{{ product.id }}">
                                </div>
                            </div>
                        </div>
                        <!-- This column is for the form button, one to go back and continue shopping
                        the other button is to add the product to the shopping trolley -->
                        <div class="col-12">
                            <a href="{% url 'products' %}" class="btn btn-secondary custom-bg rounded-0 mt-5">
                                <span class="icon">
                                    <i class="fas fa-arrow-left"></i>
                                </span>
                                <span class="text-uppercase">continue shopping</span>
                            </a>
                            <input type="submit" class="btn btn-outline-dark rounded-0 text-uppercase mt-5"
                                value="Add to Trolley">
                        </div>
                        <!-- This hidden field redirects the user using the current url back to the same page
                        once the product is added to the shopping trolley -->
                        <input type="hidden" name="redirect_url" value="{{ request.path }}">
                        {% endwith %}
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}